<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../favicon.ico">

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>

    <title>Home</title>

    <!-- Bootstrap core CSS -->
    <link href="../static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../static/css/homeCSS.css" rel="stylesheet">
    <style type="text/css">
      .knockout {
        background: url(http://apod.nasa.gov/apod/image/0603/coma_misti.jpg) -80px -80px;
        color: red;
        -webkit-text-fill-color: transparent;
        -webkit-background-clip: text;
        font-weight: bold;
        font-size: 100px;
        font-family: arial, helvetica;
        width: 600px;
        margin: 50px auto;
        text-align: center;
      }
    </style>
  </head>

  <body background="blah.jpg">

    <div class="site-wrapper">

      <div class="site-wrapper-inner">

        <div class="cover-container">

          <!-- navbar -->
          <div class="masthead clearfix">
            <div class="inner">
              <nav class="nav nav-masthead">
                <a class="nav-link active" href="#">Home</a>
                <a class="nav-link" href="#">About</a>
                <a class="nav-link" href="#">Contact</a>
              </nav>
            </div>
          </div>
          <!--nabar -->

<!-- Code from Old Home Html -->
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
	    <script src="spotify-web-api.js"></script>
        <div class="knockout" style="width:100%">DJarvis</div>

        <section class="intro"></section>

       	<div class="inner cover">
           <p class="lead">
	      	<a href="/login" class="btn btn-lg btn-primary">Log in with Spotify</a>
             <a href="camService" class="btn btn-lg btn-secondary" id = "captureImg">Lets Get Started!</a>
            </p>
        </div>
            <script type="text/javascript">
              (function() {

		        /**
		         * Obtains parameters from the hash of the URL
		         * @return Object
		         */
		        function getHashParams() {
		          var hashParams = {};
		          var e, r = /([^&;=]+)=?([^&;]*)/g,
		              q = window.location.hash.substring(1);
		          while ( e = r.exec(q)) {
		             hashParams[e[1]] = decodeURIComponent(e[2]);
		          }
		          return hashParams;
		        }

		        var params = getHashParams();

		        var access_token = params.access_token,
		            refresh_token = params.refresh_token,
		            error = params.error;

		        if (error) {
		          alert('There was an error during the authentication');
		        } else {
			        if (access_token) {
			        	$.ajax({
			                url: 'https://api.spotify.com/v1/me',
			                headers: {
			                  'Authorization': 'Bearer ' + access_token
			                },
			                success: function(userResponse) {
			                	var userID = userResponse.id;
					            var spotifyApi = new SpotifyWebApi();
					          	spotifyApi.setAccessToken(access_token);
					          	var limitOption = {
					          		"limit" : "1"
					          	};
					          	spotifyApi.getMyTopArtists()
					          	.then(function(artistResponse){
					          		//console.log("artist:", artistResponse.items);
					          		spotifyApi.getMyTopTracks(limitOption)
					          		.then(function(trackResponse) {
						          		var seeds = {
						          			"seed_artists" : artistResponse.items[2].id,
						          			"seed_tracks" : trackResponse.items[0].id
						          		};
						          		spotifyApi.getRecommendations(seeds)
						          		.then(function(recommendationResponse){
						          			//console.log("recommendation: ",recommendationResponse);
						          			var trackList = []
						          			for(var track in recommendationResponse.tracks) {
						          				trackList.push("spotify:track:"+recommendationResponse.tracks[track].id)
						          				//console.log("tracklist: ",track);
						          			}
						          			var newPlaylistOptions = {
											  "name": "DJarvis"
											};
						          			spotifyApi.createPlaylist(userID, newPlaylistOptions)
						          			.then(function(newPlaylistResponse){
						          				//console.log("new list: ",newPlaylistResponse);
						          				//console.log("tracklist: ",trackList);
						          				var newPlaylistID = newPlaylistResponse.id;
						          				spotifyApi.addTracksToPlaylist(userID, newPlaylistResponse.id, trackList, null)
						          				.then(function(finalPlaylist){
						          					console.log(newPlaylistResponse.id);
						          				});
						          			});
						          		});
					          		})
					          	});
					        }
			        	});
			        } else {
			            // render initial screen
			            $('#login').show();
			        }         
		    	}
		    })();
          </script>

        </div>

      </div>

    </div>

  </body>


</html>
